import Head from "next/head";
import React from "react";
import Image from "next/image";
import { GetStaticProps } from "next";
import { ParsedUrlQuery } from "querystring";
import { BLOG_URL } from "@constants/url";
import { Blog } from "@common-types/blog";
import { Banner, Navigation, Text } from "@components/common";
import style from "../styles/base/common.module.css";
import Header from "@sections/Header";
import Footer from "@sections/Footer";
import axios from "axios";

interface BlogProps {
  blog: Blog;
}

interface IParams extends ParsedUrlQuery {
  slug: string;
}

export const getStaticPaths = async () => {
  const blogs = await axios.get(BLOG_URL);

  const paths = blogs.data.map((blog: Blog) => {
    return {
      params: { slug: blog.slug },
    };
  });

  return { paths, fallback: false };
};

export const getStaticProps: GetStaticProps = async (context) => {
  const { slug } = context.params as IParams;
  const res = await axios.get(BLOG_URL + "?slug=" + slug);

  return {
    props: {
      blog: res.data[0],
    },
  };
};

const BlogDetail: React.FC<BlogProps> = ({ blog }) => {
  const {
    title = "",
    expertId = "",
    createDate = "",
    description = "",
    image = { url: "/images/past-present-future.avif", alt: "" },
  } = blog ? blog : {};

  return (
    <div>
      <Head>
        <title>Dealer Marketing</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
          integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
          crossOrigin="anonymous"
          referrerPolicy="no-referrer"
        />
      </Head>

      <Header />
      <Navigation />
      <Banner url={image.url} text="" />
      <div className="container">
        <div className={style["style-info"]}>
          <div className={style["style-card"]}>
            <div className={style["style-title"]}>
              <Text size="largeDark" text={title} />
            </div>
            <hr />
            <div className={style["style-author"]}>
              <figure>
                <Image
                  src={image.url}
                  alt={image.alt}
                  className={style["style-image"]}
                  width={60}
                  height={60}
                  placeholder="blur"
                  blurDataURL="/images/backgrounds/blur.jpg"
                />
              </figure>
              <div className={style["style-funeral"]}>
                <p>
                  by <span>{expertId}</span>
                </p>
                <p>{createDate}</p>
              </div>
            </div>
          </div>
          <hr />
          <div className={style["style-info-regular"]}>
            <Text size="regular" text={description} />
          </div>
        </div>
      </div>
      <Footer />
    </div>
  );
};

export default BlogDetail;
