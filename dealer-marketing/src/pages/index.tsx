import type { NextPage } from "next";
import Script from "next/script";
import { useContext, useEffect } from "react";
import axios from "axios";
import Head from "next/head";

// components
import { Banner, Navigation } from "@components/common";

// constants
import { BLOG_URL } from "@constants/url";

// common-types
import { Blog } from "@common-types/blog";

// layouts
import Footer from "@layouts/Footer";
import Header from "@layouts/Header";

import { DataContext } from "@context/DataContext";
import MainSection from "@sections/MainSection";
import { BLOG_RESPONSE_DATA } from "@api-backup/blogResponseData";

interface HomeProps {
  blogs: Blog[];
  errorCode: string;
}

export const getStaticProps = async () => {
  try {
    // const res = await axios.get(BLOG_URL);
    // const blogs = res.data;
    const blogs: Blog[] = BLOG_RESPONSE_DATA;
    return {
      props: {
        blogs: blogs,
        errorCode: false,
      },
    };
  } catch (errorCode) {
    return {
      props: {
        blogs: [],
        errorCode: errorCode,
      },
    };
  }
};

const Home: NextPage<HomeProps> = ({ blogs, errorCode }) => {
  const { setBlogs, setErrorCode } = useContext(DataContext);
  useEffect(() => {
    setBlogs(blogs);
    setErrorCode(errorCode);
  }, []);

  return (
    <>
      <Head>
        {/* Google Tag Manager */}
        <Script
          strategy="afterInteractive"
          type="text/partytown"
          dangerouslySetInnerHTML={{
            __html: `(function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
            var f = d.getElementsByTagName(s)[0],
              j = d.createElement(s),
              dl = l != "dataLayer" ? "&l=" + l : "";
            j.async = true;
            j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
            f.parentNode.insertBefore(j, f);
          })(window, document, "script", "dataLayer", "GTM-WK9ZN93")`,
          }}></Script>
        {/* End Google Tag Manager */}
        <title>Dealer Marketing</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <Header />
        <Navigation />
        <Banner
          url="/images/backgrounds/home-page.png"
          blurDataURL="/images/backgrounds/blur.jpg"
          text="Expert Automotive Knowledge at Your Fingertips"
        />
        <MainSection />
      </main>
      <Footer />
    </>
  );
};

export default Home;
